{%extends 'home/base.html'%}

{%block content%}


<link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
<script src="https://cdn.plyr.io/3.7.8/plyr.js">

    function share() {
    var url = "{% url 'video-detail' video.pk %}"; // Replace with your website URL
    var title = "توسط مهندس کیانی {{video.grade}} پایه {{video.Unit}} تدریس فصل"; // Replace with your desired title
    var text = "{{video.Description}}"; // Replace with your desired text

    navigator.share({
        url: url,
        title: title,
        text: text
    })
    .then(() => console.log("Shared successfully"))
    .catch((error) => console.error("Error sharing:", error));
    }
</script>

<style>
    .container {
        display: grid;
        grid-template-columns: 11fr 5fr;
        height: fit-content;
        width: 100%;
    }

    .video-container {
        width: 100%;
        height: 100%;
    }
    
    :root { 
        --plyr-color-main:'black';
    }
    
    .line {
			position: relative;
			height: 2px;
			background-image: linear-gradient(to right, transparent, black 50%, transparent), linear-gradient(to left, transparent, black 50%, transparent);
			background-position: center;
			background-repeat: no-repeat;
            margin: auto;
            display: block;
            width: 85%;

		}

    .options {
        display: flex;
        margin: auto;
        width: 80%;
        flex-direction: row;
        height: fit-content;
        gap: 20px;
        margin-top: 30px;
        position: relative;
    }

    .tags {
        width: fit-content;
        height: 100%;
        right: -10px;
        border: 1px solid #bdbdbd;
        border-bottom-right-radius: 20px;
        border-top-left-radius: 20px;
        padding: 2px 10px;
        position: absolute;
        height: fit-content;
        font-size: .85rem;
        
    }
    
    .Box-1 {
        width: 100%;
        height: fit-content;
        position: relative;
        border-radius: 10px;
        overflow: hidden;
        padding-bottom: 50px;
        border: 1px solid #dadada;
    }

    .Box-2 {
        display: block;
        margin: auto;
        width: 90%;
        height: 100%;
        border: 1px solid #dadada;
        border-radius: 8px;
        overflow-y: auto;
        overflow-x:hidden;
        padding: 1em;
        
    }

    .video-suggest { 
        width: 100%;
        margin: auto;
        display: flex;
        height: fit-content;
        border: 1px solid #EAEAEA;
        flex-direction: row;
        gap: 3px;
        cursor: pointer;
        border-radius: 5px;
        margin: 5px 0 ;
        overflow: auto;
        
    }

    .video-suggest:hover {
        border: 1px solid #d3d3d3;
    }

    @media screen and (max-width: 768px) {
        .container {
            grid-template-columns: 1fr;
            grid-template-rows: 1fr 1fr;
        }

        .Box-2 {
            margin-top: 50px;
        }

    }
</style>

<main>
    <div class="container">
        <div class="Box-1">

                <div id="video-container">
                    {{video.url|safe}}
                </div>
                <div class="line" style="width: 90%;margin-top: 5px;"></div>
                <h2 style="text-align: end;margin-right: 20px;">{{video.Title}}</h2>
                <p style="display: block;text-align: right;margin-right: 25px;color: rgb(66, 66, 66);">{{video.Description}}</p>
                <div class="options">

                    <a href="{{video.File.url}}">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-download" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" >
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                        <path d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2"></path>
                        <path d="M7 11l5 5l5 -5"></path>
                        <path d="M12 4l0 12"></path>
                     </svg>
                    </a>

                    {%if video in watchlist%}
                        <button id="my-button" style="border: none;cursor: pointer;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-bookmarks" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="black" stroke-linecap="round" stroke-linejoin="round" id="wl" style="transition: all 400ms ease;">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                <path d="M13 7a2 2 0 0 1 2 2v12l-5 -3l-5 3v-12a2 2 0 0 1 2 -2h6z"></path>
                                <path d="M9.265 4a2 2 0 0 1 1.735 -1h6a2 2 0 0 1 2 2v12l-1 -.6"></path>
                            </svg>
                        </button>
                    {%else%}
                        <button id="my-button" style="border: none;cursor: pointer;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-bookmarks" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" id="wl" style="transition: all 400ms ease;">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                <path d="M13 7a2 2 0 0 1 2 2v12l-5 -3l-5 3v-12a2 2 0 0 1 2 -2h6z"></path>
                                <path d="M9.265 4a2 2 0 0 1 1.735 -1h6a2 2 0 0 1 2 2v12l-1 -.6"></path>
                            </svg>
                        </button>

                    {%endif%}

                     <button style="border: none;cursor: pointer;" onclick="share();">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                            <path d="M9 15l6 -6"></path>
                            <path d="M11 6l.463 -.536a5 5 0 0 1 7.071 7.072l-.534 .464"></path>
                            <path d="M13 18l-.397 .534a5.068 5.068 0 0 1 -7.127 0a4.972 4.972 0 0 1 0 -7.071l.524 -.463"></path>
                         </svg>
                        </button>

                     <div class="tags">
                        {{video.grade}} فصل {{video.Unit}} 
                    </div>
                </div>
        </div>


        <div class="Box-2" id="Box-2">
            {%for video in videos_related%}
                <a class="video-suggest" href="{{video.pk}}" id="video-suggest-{{video.pk}}">
                    <img src="{{video.Thumbnail.url}}" style="width: 50%;">
                    <p style="font-size: .7rem;text-align: end;width: 90%;padding: .5em;">{{video.Title}}</p>
                </a>
            {%endfor%}
        </div>
    </div>
</main>

<script>
    const player = new Plyr('#player',{
        previewThumbnails:{enabled:true,src:'{{video.Thumbnail.url}}'},
        settings:['quality', 'speed', 'loop'],
        controls:['play-large', 'play', 'progress', 'current-time', 'mute', 'volume',  'settings','quality', 'fullscreen']
    });



    const element = document.getElementById('video-suggest-{{video.pk}}');
    const Box = document.getElementById('Box-2')
    const YPOS = element.offsetTop;
    Box.scrollTo({top:YPOS,behavior:'smooth'});

    const button = document.getElementById('wl')
    $(document).ready(function(){
    $('#my-button').click(function(){
        $.ajax({
            type: 'POST',
            url: '{% url "video-detail" video.pk%}',
            data: {
                // Your data here
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function(response){
                if (response.message == 'add'){
                    button.style.fill = 'black'
                }
                else{
                    button.style.fill = 'none'
                }
            }
        });
    });
});
  </script>
{%endblock content%}